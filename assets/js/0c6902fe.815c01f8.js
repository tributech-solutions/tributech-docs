"use strict";(self.webpackChunktributech_docs=self.webpackChunktributech_docs||[]).push([[5438],{57882:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>g});var a=n(58168),r=(n(96540),n(15680));const i={title:"API Integration",sidebar_position:2},o=void 0,l={unversionedId:"tributech_node/API_integration",id:"version-3.6.0/tributech_node/API_integration",title:"API Integration",description:"Rest API",source:"@site/versioned_docs/version-3.6.0/tributech_node/API_integration.md",sourceDirName:"tributech_node",slug:"/tributech_node/API_integration",permalink:"/3.6.0/tributech_node/API_integration",draft:!1,editUrl:"https://github.com/tributech-solutions/tributech-dsk-docs/edit/master/versioned_docs/version-3.6.0/tributech_node/API_integration.md",tags:[],version:"3.6.0",sidebarPosition:2,frontMatter:{title:"API Integration",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/3.6.0/tributech_node/overview"},next:{title:"API Usage",permalink:"/3.6.0/tributech_node/API_usage"}},s={},g=[{value:"Rest API",id:"rest-api",level:2},{value:"Webhooks",id:"webhooks",level:2},{value:"General",id:"general",level:3},{value:"Webhook Headers",id:"webhook-headers",level:3},{value:"Header Example",id:"header-example",level:4},{value:"Payload Example",id:"payload-example",level:4},{value:"Signature Code Example",id:"signature-code-example",level:3},{value:"Authorization",id:"authorization",level:2},{value:"Authorization Flow",id:"authorization-flow",level:4},{value:"Client Credential Flow",id:"client-credential-flow",level:4}],p={toc:g},u="wrapper";function d(e){let{components:t,...i}=e;return(0,r.yg)(u,(0,a.A)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"rest-api"},"Rest API"),(0,r.yg)("p",null,"Our REST API provides the interfaces as ",(0,r.yg)("a",{parentName:"p",href:"https://swagger.io/specification/v3/"},"OAS V3")," which can be used to generate REST API clients for multiple languages. "),(0,r.yg)("p",null,"The api is generally reachable via the url ",(0,r.yg)("inlineCode",{parentName:"p"},"<your-node-url>/demeter/api/"),"  there you can find the json document and a swagger doc website with an general overview of the rest api endpoints. "),(0,r.yg)("p",null,'The API is structured with following "Topics" :'),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Agent"))," provides all management regarding a single Tributech Agent"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Agents"))," for query propose of multiple agents "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Credentials"))," to fetch the credentials of the api, docker registry etc... "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Graph"))," provides the Twin Configuration Instance as graph"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Model"))," fetching DTDL Model Information"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"ModelManagement"))," CRUD Methods for the DTDL Models"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Relationships"))," CRUD Methods for the Relationships between DTDL Instances"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Twins"))," CRUD Methods for DTDL Instances"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Validation"))," Validation for DTDL Models"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"WebHookSubscription"))," CRUD Methods for Webhook related Subscriptions"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"WebHookTopic"))," Query all available Webhook Events"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Values"))," Fetch or Insert Values from or to the Node"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},(0,r.yg)("em",{parentName:"strong"},"Proofs"))," Validate , insert or fetch proofs from the Node")),(0,r.yg)("p",null,"To do some example request just visit the above url, authorize yourself ",(0,r.yg)("em",{parentName:"p"},"(see below)")," and try it out ! "),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Tributech Node - OAS",src:n(40600).A,width:"1729",height:"1224"})),(0,r.yg)("h2",{id:"webhooks"},"Webhooks"),(0,r.yg)("h3",{id:"general"},"General"),(0,r.yg)("p",null,"Our Node provides webhooks to enable external parties to receive node events in a pushed based manner. The body of the payload differs from event to event but will always be an json format. In order to identify the current Webhook payload you will need to look into the http headers of the given event."),(0,r.yg)("p",null,"Also we provide an ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"HMAC SHA256"))," signature within the header to prevent spoofing attacks. The secret of the given HMAC will be provided at the creation time of the webhook subscription and will never be exposed by any rest api endpoints. "),(0,r.yg)("p",null,"We provide you a .net code where you can validate the signature to verify that it is not tempered . "),(0,r.yg)("hr",null),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"}," NOTE ")),(0,r.yg)("br",{parentName:"p"}),"\n","Additionally in a case of an error delivery we implemented an back-off redelivery mechanism. "),(0,r.yg)("p",null,"A error delivery may occur in following situations: "),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Network is not available"),(0,r.yg)("li",{parentName:"ul"},"Endpoint described within the subscription is not reachable"),(0,r.yg)("li",{parentName:"ul"},"Endpoint returns something else then a HTTP 200 (OK) ")),(0,r.yg)("p",null,"In order to provide a stable redelivery we divided the Webhook Events in two categories : "),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Event QOS = 1 , high frequency events (like data received)"),(0,r.yg)("li",{parentName:"ol"},"Event QOS = 2, standard frequency events ")),(0,r.yg)("p",null,"High frequency events will be retried for ",(0,r.yg)("strong",{parentName:"p"},"four times")," and then will be discarded. Standard Frequency events have ",(0,r.yg)("strong",{parentName:"p"},"ten retries")," till they are discarded."),(0,r.yg)("p",null,"Back off Formulary is ",(0,r.yg)("inlineCode",{parentName:"p"},"(Attempt Count + 0,7) ^ 4 + Minimum Retry Interval")),(0,r.yg)("hr",null),(0,r.yg)("h3",{id:"webhook-headers"},"Webhook Headers"),(0,r.yg)("p",null,"Following Headers are present in the Webhook request: "),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"x-tributech-correlationid")," trace id to track the data through our node"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"x-tributech-eventid")," unique identifier through the node (guid) to identify the event "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"x-tributech-event")," event name to identify the type of event "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"x-tributech-signaturetimestamp")," creation timestamp utc of the signature"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"x-tributech-signature")," signature of the webhook event"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"x-tributech-timestamp")," event timestamp utc")),(0,r.yg)("h4",{id:"header-example"},"Header Example"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Header Identifier"),(0,r.yg)("th",{parentName:"tr",align:null},"Value"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"x-tributech-correlationid"),(0,r.yg)("td",{parentName:"tr",align:null},"00000000-0000-0000-0000-000000000000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"x-tributech-eventid"),(0,r.yg)("td",{parentName:"tr",align:null},"49acaa7b-fa72-4863-ab4b-7933fedeb59a")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"x-tributech-event"),(0,r.yg)("td",{parentName:"tr",align:null},"ValueReceivedEvent")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"x-tributech-signaturetimestamp"),(0,r.yg)("td",{parentName:"tr",align:null},"06/16/2023 05:08:46 +00:00")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"x-tributech-signature"),(0,r.yg)("td",{parentName:"tr",align:null},"sha256=0316443119ED851EE18AA6176E8281E6A28D02A52EAF5DC85D45A6149173F412")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"x-tributech-timestamp"),(0,r.yg)("td",{parentName:"tr",align:null},"06/16/2023 05:08:43 +00:00")))),(0,r.yg)("h4",{id:"payload-example"},"Payload Example"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "StreamId": "6e89214f-65a1-429c-8569-c0d14126b3da",\n  "Timestamp": "2023-06-16T05:08:40.991585+00:00",\n  "Value": [\n    0,\n    0,\n    0,\n    224,\n    127,\n    78,\n    72,\n    184\n  ],\n  "EventQoS": 1\n}\n')),(0,r.yg)("h3",{id:"signature-code-example"},"Signature Code Example"),(0,r.yg)("p",null,"This code example can be used to create the exact same signature which is present in the header (without the ",(0,r.yg)("inlineCode",{parentName:"p"},"sha256=")," prefix)."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-csharp"},'    public string HashHMAC(string secret, string webHookPayloadJson, DateTimeOffset signatureTimestamp) {\n        var encoding = new System.Text.ASCIIEncoding();\n        var messageHash = new HMACSHA256(encoding.GetBytes(secret));\n        var payload = encoding.GetBytes(webHookPayloadJson)\n                              .Concat(encoding.GetBytes(signatureTimestamp.ToString(CultureInfo.InvariantCulture)))\n                              .ToArray();\n        var signature = messageHash.ComputeHash(payload);\n        return BitConverter.ToString(signature).Replace("-", "");\n    }\n')),(0,r.yg)("h2",{id:"authorization"},"Authorization"),(0,r.yg)("p",null,"Our API Authorization is handled via a Keycloak instance. We support following authorization flows : "),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://auth0.com/docs/get-started/authentication-and-authorization-flow/client-credentials-flow"},"Client Crediential Flow")," (for api access)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce"},"Authorization Code Flow with PCKE (sha256)")," (for browser)")),(0,r.yg)("p",null,"Both can be configured within the Keycloak instance hosted on our Tributech Node Instance. "),(0,r.yg)("p",null,"We provide no user or group permissions for our node. "),(0,r.yg)("p",null,"In general following urls are used for authorization and token : "),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Authorization: ",(0,r.yg)("inlineCode",{parentName:"li"},"https://auth.<your-tributech-node-url>/realms/node/protocol/openid-connect/auth")),(0,r.yg)("li",{parentName:"ul"},"Token: ",(0,r.yg)("inlineCode",{parentName:"li"},"https://auth.<your-tributech-node-url>/realms/node/protocol/openid-connect/token"))),(0,r.yg)("p",null,"Client Id and Client Credentials can be retrieved by our Node website or on request."),(0,r.yg)("p",null,"Example Request done with ",(0,r.yg)("a",{parentName:"p",href:"https://insomnia.rest/"},"Insomnia")),(0,r.yg)("h4",{id:"authorization-flow"},"Authorization Flow"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Tributech Node - Authorization Flow",src:n(43679).A,width:"1475",height:"1556"})),(0,r.yg)("h4",{id:"client-credential-flow"},"Client Credential Flow"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Tributech Node - Client Credential Flow",src:n(79873).A,width:"1483",height:"1030"})))}d.isMDXComponent=!0},15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>m});var a=n(96540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),g=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=g(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},y=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=g(n),y=r,m=u["".concat(s,".").concat(y)]||u[y]||d[y]||i;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=y;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var g=2;g<i;g++)o[g]=n[g];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}y.displayName="MDXCreateElement"},43679:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/AuthorizationCodeFlow-277acb6fe67f701bc4e0c49c4d459c19.png"},79873:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/ClientCredentialFlow-5c3a4f8d81946976221f51f6cecfe768.png"},40600:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/OAS-d3e9fbc21a91b37331154f6e83af47c3.png"}}]);