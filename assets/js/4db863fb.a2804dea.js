"use strict";(self.webpackChunktributech_docs=self.webpackChunktributech_docs||[]).push([[4912],{222:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-quickstart-vco-add-config-1a2971499336bd00b4580d6f82d5859b.png"},274:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-command-overview-60b657b17234d0698df6ee039aa4a894.png"},1304:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-streamid-007f7c8c131a946ae981a9cd8f3cbd65.png"},2153:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-command-send-63fd6a3c39f74e341af5f658e11551d4.png"},3059:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/files/docker-compose-mqtt-port-9307b25502ff06654615222379ebf5f8.yml"},4069:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-quickstart-vco-add-4ca130a4bd01d35d63aed8256903ec16.png"},5287:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tributech_agent/source_integration","title":"Source Integration","description":"Source Definition","source":"@site/versioned_docs/version-3.6.0/tributech_agent/source_integration.md","sourceDirName":"tributech_agent","slug":"/tributech_agent/source_integration","permalink":"/3.6.0/tributech_agent/source_integration","draft":false,"unlisted":false,"editUrl":"https://github.com/tributech-solutions/tributech-dsk-docs/edit/master/versioned_docs/version-3.6.0/tributech_agent/source_integration.md","tags":[],"version":"3.6.0","sidebarPosition":4,"frontMatter":{"title":"Source Integration","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Agent Integration","permalink":"/3.6.0/tributech_agent/agent_integration"},"next":{"title":"MQTT Source","permalink":"/3.6.0/tributech_agent/sources/mqtt_source"}}');var r=n(4848),i=n(8453);const o={title:"Source Integration",sidebar_position:4},a=void 0,c={},d=[{value:"Source Definition",id:"source-definition",level:2},{value:"Custom Sources",id:"custom-sources",level:3},{value:"Gain <em><strong>access</strong></em> to the Tributech Agent",id:"gain-access-to-the-tributech-agent",level:4},{value:"<em><strong>Data Structure</strong></em>",id:"data-structure",level:4},{value:"<em><strong>Send data</strong></em>",id:"send-data",level:4},{value:"Twin Model",id:"twin-model",level:2},{value:"Commands",id:"commands",level:2},{value:"Value Change Options",id:"value-change-options",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"source-definition",children:"Source Definition"}),"\n",(0,r.jsx)(t.p,{children:"The Tributech Agent service supports the integration of external data sources with the help of Tributech Sources. In the following section we describe the general properties of Tributech Source and how they are used."}),"\n",(0,r.jsx)(t.p,{children:"For a detailed guide on how to use the different sources visit:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Source"}),(0,r.jsx)(t.th,{children:"Guide"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"MQTT"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/mqtt_source",children:(0,r.jsx)(t.strong,{children:"MQTT Source Guide"})})," integrates data provided via ",(0,r.jsx)(t.a,{href:"https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html",children:"MQTT"}),"."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"OPC-UA"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/opcua_source",children:(0,r.jsx)(t.strong,{children:"OPC-UA Source Guide"})})," integrates data provided by an OPC-UA conform interface."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Beckhoff ADS"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/ads_source",children:(0,r.jsx)(t.strong,{children:"ADS Source Guide"})})," integrates data provided by an Beckhoff ADS PLC Server."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Simulated Sensor"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/simulated_source",children:(0,r.jsx)(t.strong,{children:"Simulated Source Guide"})})," integrates data provided by test sources generating random data."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"REST"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/rest_source",children:(0,r.jsx)(t.strong,{children:"REST Source Guide"})})," integrates data provided via ",(0,r.jsx)(t.a,{href:"https://swagger.io/specification/",children:"HTTP APIs"}),"."]})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["In order to add sources to an linked Tributech Agent we need to select the ",(0,r.jsx)(t.code,{children:"CONFIGURE"})," button every agent contains:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"&quot;Configure Agent",src:n(6855).A+"",width:"1909",height:"351"})}),"\n",(0,r.jsxs)(t.p,{children:["There is an another way for advanced users to configure an Tributech Agent, which we will describe in a later section (see ",(0,r.jsx)(t.a,{href:"#twin-model",children:"Twin Models"}),")."]}),"\n",(0,r.jsx)(t.h3,{id:"custom-sources",children:"Custom Sources"}),"\n",(0,r.jsxs)(t.p,{children:["It is possible to implement custom source and handle the data integration yourself by implementing a client that sends a predefined json payload to a predefined MQTT Topic of the Tributech Agent.\nWe show all requirements for a successful custom source integration based on the ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/quickstart",children:"QuickStart Simulated Source"})," in this section."]}),"\n",(0,r.jsxs)(t.h4,{id:"gain-access-to-the-tributech-agent",children:["Gain ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"access"})})," to the Tributech Agent"]}),"\n",(0,r.jsxs)(t.p,{children:["First, we need access to the same MessageBroker the Tributech Agent uses. We can expose the port of the message broker inside the docker environment (see ",(0,r.jsx)(t.a,{href:"https://docs.docker.com/compose/networking/",children:"Docker Networking"}),") by changing the service mosquitto-server-simulated (complete update ",(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(3059).A+"",children:"docker-compose.yml"}),"):"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"    mosquitto-server-simulated:\n        image: eclipse-mosquitto:${MQTT_TAG:-latest}\n        networks:\n        - simulated-net\n        ports: \n        - '1883:1883' # MQTT\n        - '127.0.0.1:9001:9001' # web-socket\n        restart: unless-stopped\n"})}),"\n",(0,r.jsx)(t.h4,{id:"data-structure",children:(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Data Structure"})})}),"\n",(0,r.jsx)(t.p,{children:"Secondly, the Tributech Node requires a certain payload structure in order to have all relevant information\nfor processing data. An example of valid json data for the Tributech Agent is shown in the following fragment:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'    [\n        {\n            "DataStreamID":"7d19fe9a-a01f-486d-9140-59ed4255835c",\n            "Timestamp":"2023-07-12T08:17:52.790354+00:00",\n            "Value":"gV57FU1ScB+n4g=="\n        }\n    ]\n'})}),"\n",(0,r.jsx)(t.p,{children:"The json payload contains the following fields:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"DataStreamID"})})," is a unique identifier for streams and can be copied from the top right corner of a stream:\n",(0,r.jsx)(t.img,{alt:"StreamId",src:n(1304).A+"",width:"1718",height:"792"})]}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Timestamp"})})," is a an ",(0,r.jsx)(t.a,{href:"https://www.iso.org/iso-8601-date-and-time-format.html",children:"ISO 8601-1:2019"})," formatted string"]}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Value"})})," is a Base64-encoded raw-bytes of the actual value.\nFor the data encoding and conversion to other formats we use the industry standards as implemented by the ",(0,r.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/dotnet/api/system.bitconverter?view=net-5.0",children:(0,r.jsx)(t.strong,{children:".NET Framework BitConverter"})}),".\nThe code fragment shows how the different types are converted into a byte array:"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:'using System;\nusing System.Text;\n                \npublic class Program\n{\n    public static void Main()\n    {\n        Console.WriteLine(Convert.ToBase64String(GetBytes(2.3d)));\n    }\n    \n    public static byte[] GetBytes<T>(T value)\n    {\n        if (value == null)\n        {\n            return Array.Empty<byte>();\n        }\n\n        return value switch\n        {\n            byte[] tValue => tValue,\n            byte tValue => new [] { tValue },\n            short tValue => BitConverter.GetBytes(tValue),\n            ushort tValue => BitConverter.GetBytes(tValue),\n            float tValue => BitConverter.GetBytes(tValue),\n            double tValue => BitConverter.GetBytes(tValue),\n            uint tValue => BitConverter.GetBytes(tValue),\n            int tValue => BitConverter.GetBytes(tValue),\n            long tValue => BitConverter.GetBytes(tValue),\n            ulong tValue => BitConverter.GetBytes(tValue),\n            bool tValue => BitConverter.GetBytes(tValue),\n            string tValue => string.IsNullOrWhiteSpace(tValue)\n                ? Array.Empty<byte>()\n                : Encoding.UTF8.GetBytes(tValue),\n            _ => throw new ArgumentOutOfRangeException(nameof(value), "Type is not supported")\n        };\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h4,{id:"send-data",children:(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Send data"})})}),"\n",(0,r.jsxs)(t.p,{children:["By sending the previously described json payload to Topic endpoint ",(0,r.jsx)(t.code,{children:"edge/{agent-id}/value/ValueSource"})," you can provide the data to the Tributech Agent directly. The Agent-Id can be found in the right top corner of an agent:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"AgentId*",src:n(7052).A+"",width:"1726",height:"548"})}),"\n",(0,r.jsxs)(t.p,{children:["Note you can use tools like ",(0,r.jsx)(t.a,{href:"https://mqtt-explorer.com/",children:"MQTT Explorer"})," to send the data to the Tributech Agent Topic."]}),"\n",(0,r.jsx)(t.h2,{id:"twin-model",children:"Twin Model"}),"\n",(0,r.jsxs)(t.p,{children:["The configuration of all Tributech Source is based on ",(0,r.jsx)(t.a,{href:"https://azure.microsoft.com/en-us/products/digital-twins",children:"Digital Twins"}),". The best way to see how sources are configured is to export existing configuration, e.g. ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/quickstart",children:"QuickStart Configuration"}),":"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"TwinConfig export",src:n(5702).A+"",width:"630",height:"447"})}),"\n",(0,r.jsx)(t.p,{children:"We support two different exports:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"To File"})}),": Exports the current workspace Twin configuration to a json file."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"To Template File"})}),": Exports the current workspace Twin configuration to a json file and replaces the unique ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"dtId's"})})," for all elements with placeholder."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"We also support three different types of imports:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"From File"})}),": Import Twin configuration into the current workspace from a json file (same format as ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Export - To File"})}),")."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"From Text"})}),": Import a json formatted text containing a ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"digitalTwinsGraph"})}),", e.g. part of the ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Export - To File"})})," (the value of the property ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"digitalTwinsGraph"})}),")"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"From Template File"})}),": Import Twin configuration into the current workspace from a json file and replaces ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"dtId's"})})," placeholders with unique id's  (same format like ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Export - To Template File"})}),")"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Note: The Twin Model can also be set directly for the Tributech Sources by submitting the value of the property ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"digitalTwinsGraph"})})," to the MessageBroker of the Tributech Source and the topic ",(0,r.jsx)(t.code,{children:"__edge/{agent-id}/twin/SetTwin__"})," (see the following Screenshot). However, we recommend this only for advanced users because an invalid twin config can render the Tributech Source non-operational."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"AgentId*",src:n(7052).A+"",width:"1726",height:"548"})}),"\n",(0,r.jsx)(t.h2,{id:"commands",children:"Commands"}),"\n",(0,r.jsxs)(t.p,{children:["The Tributech Node is capable of sending commands to some Tributech Sources to control their behaviour.\nCommands can be send with one button in the  ",(0,r.jsx)(t.code,{children:"COMMANDS"})," tab of an specific agent, e.g. Send command to ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/quickstart",children:"QuickStart Simulated Source"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Command Overview",src:n(274).A+"",width:"1741",height:"577"})}),"\n",(0,r.jsxs)(t.p,{children:["With the following payload we trigger an anomaly, in the simulated source, that changes the next generated value to double the maximum value of the simulated stream, i.e. 20 based on the ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/quickstart",children:"QuickStart Simulated Source"}),". A simulated source example:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Command Send",src:n(2153).A+"",width:"1746",height:"681"})}),"\n",(0,r.jsxs)(t.p,{children:["When we switch back to the ",(0,r.jsx)(t.code,{children:"SOURCES"})," tab and select our ",(0,r.jsx)(t.code,{children:"Simulated Stream"})," we see the anomaly with value 20."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Anomaly Event Graph result",src:n(5652).A+"",width:"1721",height:"785"})}),"\n",(0,r.jsxs)(t.p,{children:["We can also inspect the result of the source command by selecting the execution in the ",(0,r.jsx)(t.code,{children:"COMMANDS"})," tab and select execution time."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Source Command result",src:n(8080).A+"",width:"1732",height:"790"})}),"\n",(0,r.jsx)(t.h2,{id:"value-change-options",children:"Value Change Options"}),"\n",(0,r.jsxs)(t.p,{children:["All Tributech Sources support ",(0,r.jsx)(t.code,{children:"Value Change Options"})," (",(0,r.jsx)(t.code,{children:"VCO"}),") that can be used to apply additional adjustments to Streams, if the ",(0,r.jsx)(t.code,{children:"Stream Data Encoding"})," is set. If ",(0,r.jsx)(t.code,{children:"VCO"})," can not be applied the data is submitted to the Tributech Agent without changes. In the following example we assume that a ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/quickstart",children:"QuickStart Simulated Source"})," is set up, an describe the ",(0,r.jsx)(t.code,{children:"VCO"})," behavior based on a double stream defined in a simulated source."]}),"\n",(0,r.jsxs)(t.p,{children:["We first need to add the ",(0,r.jsx)(t.code,{children:"VCO"})," to the stream by right clicking the ",(0,r.jsx)(t.code,{children:"Simulated Stream"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"VOC Add",src:n(4069).A+"",width:"649",height:"642"})}),"\n",(0,r.jsx)(t.p,{children:"The value change options consist of three properties that can be set for a stream. We can either set all options or a subset of them."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"VOC Add",src:n(222).A+"",width:"1918",height:"839"})}),"\n",(0,r.jsx)(t.p,{children:"The properties change the data stream the following way based on the values from the screenshot:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Minimum Period (Seconds)"})})," - defines the period in which additional values are discarded, i.e. if data is sent faster than 5 seconds then it will be discarded and the next submitted value is the value that arrives after 5sec."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Maximum Period (Seconds)"})})," - defines the period after which the last successful submitted value is resend, i.e. if no value was received in the last 10sec or all values have been filtered by other VCO then the last successful value will be resubmitted."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Step (Delta)"})})," - defines the minimum difference between values to be submitted, the change is always compared to the last successful submitted value, i.e. if the double values 1, 2, 5, 8, 9, 11, 14 are received by the Tributech Source only 1 and 9 will be submitted."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Note: The ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Minimum Period (Seconds)"})}),", ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Maximum Period (Seconds)"})})," handling is the same for all Sources and Stream Data Encodings and will not be described further. However, the handling of ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"Step (Delta)"})})," may differ between the Tributech Sources and Stream Data Encodings and will therefor be explained in each Source separately, i.e. ",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/mqtt_source#value-change-options",children:"MQTT Source VCO"}),",\n",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/opcua_source#value-change-options",children:"OPC-UA Source VCO"}),",\n",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/ads_source#value-change-options",children:"ADS Source VCO"}),",\n",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/simulated_source#value-change-options",children:"Simulated Source VCO"}),",\n",(0,r.jsx)(t.a,{href:"/3.6.0/tributech_agent/sources/rest_source#value-change-options",children:"REST Source VCO"}),"."]})]})}function l(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},5652:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-command-event-graph-79ca6c8d4c0168e0a4fc6527c3462932.png"},5702:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-export-config-6265bd48f5e959e4843c7921aa2ea290.png"},6855:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-agent-configure-7ae7cf405f48c53a50f626b64ce56f49.png"},7052:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-agent-id-8a081ab46aaa6f74d54bdce7a0f68491.png"},8080:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/node-source-command-result-9e289b8894a93911b1e7afebbfbd2640.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(6540);const r={},i=s.createContext(r);function o(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);