"use strict";(self.webpackChunktributech_docs=self.webpackChunktributech_docs||[]).push([[1456],{15297:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"tributech_node/api_category/API_usage","title":"Usage","description":"This page should show some of the most used endpoints from our node.","source":"@site/versioned_docs/version-5.0.0/tributech_node/api_category/API_usage.md","sourceDirName":"tributech_node/api_category","slug":"/tributech_node/api_category/API_usage","permalink":"/tributech_node/api_category/API_usage","draft":false,"unlisted":false,"editUrl":"https://github.com/tributech-solutions/tributech-dsk-docs/edit/master/versioned_docs/version-5.0.0/tributech_node/api_category/API_usage.md","tags":[],"version":"5.0.0","sidebarPosition":1,"frontMatter":{"title":"Usage","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Stream Verification","permalink":"/tributech_node/agent/verification"},"next":{"title":"Integration","permalink":"/tributech_node/api_category/API_integration"}}');var o=t(74848),a=t(28453);const r={title:"Usage",sidebar_position:1},s="API usage overview",d={},c=[{value:"Data Streams",id:"data-streams",level:2},{value:"Proof Verification",id:"proof-verification",level:2},{value:"Agent Configuration",id:"agent-configuration",level:2},{value:"Remote Commands",id:"remote-commands",level:2},{value:"Endpoints",id:"endpoints",level:3},{value:"Example Code",id:"example-code",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"api-usage-overview",children:"API usage overview"})}),"\n",(0,o.jsx)(n.p,{children:"This page should show some of the most used endpoints from our node.\nWe will do all requests via our swagger doc website you can use your own http client or any third party application to do the rest request against our node."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Tributech Node - API User Focus",src:t(77716).A+"",width:"738",height:"337"})}),"\n",(0,o.jsx)(n.p,{children:"For this section we will use an example DTDL instance with a Tributech EDGE Agent with an OPC UA source."}),"\n",(0,o.jsx)(n.p,{children:"Example Data Stream DTDL Instance"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n      "$dtId": "6e89214f-65a1-429c-8569-c0d14126b3da",\n      "$etag": "W/\\"9f450a2f-1306-46c5-8f8e-ed33592f79bd\\"",\n      "$metadata": {\n        "$model": "dtmi:io:tributech:stream:opcua;1"\n      },\n      "Name": "Double Stream",\n      "Unit": "",\n      "Identifier": "ns=3;i=2832",\n      "Encoding": "DOUBLE"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Example EDGE Agent DTDL Instance"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n      "$dtId": "5d7f5a6f-1e90-4bc2-88d4-41a635ab9a89",\n      "$etag": "W/\\"ef628b11-346e-4790-88fc-ef65804590f0\\"",\n      "$metadata": {\n        "$model": "dtmi:io:tributech:device:edge;1"\n      },\n      "MaxMerkleTreeDepth": 5,\n      "MaxMerkleTreeAge": 600,\n      "Name": "Steel Factory Plant Line #24 test",\n      "PublicKey": "-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2vZ+/prceZnTywahSGFH\\nEcnGoZjYzzcCGAYVk5wPP3/n4qDj9HwP9dXNlvCE6NRoQwVZJ8JcO4Gjz50939dx\\nvi+CCEh6xKL1SY6eh6lzSaATJdpcUwji4XOkv3zClRO32KIcNG2bWawiWQlZLxzMMhWJVlboKAbl/XIXB6XhWn/Fi5T7ViYblI9FjAaBDhHPizegGqDmRM8YGg5HcLJf\\nw6To9bj603+/YIBPA4zEuP441RRCIj9WZi9J22gtF2ekFtq/N13GFa4wYfQeKmYQ\\nowIDAQAB\\n-----END PUBLIC KEY-----",\n      "KeyStorageType": "NONE",\n      "ProofKind": "SHA256_RSA2048_PSS",\n      "MQTTBroker": ""\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"data-streams",children:"Data Streams"}),"\n",(0,o.jsx)(n.p,{children:"Generally speaking a Data Stream is the metadata of a given source. The metadata contains the information that is used to describe the characteristics and limitations for values that can be imported by a specific endpoint."}),"\n",(0,o.jsx)(n.p,{children:"Here are some example metadata information:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Encoding data type of the endpoint"}),"\n",(0,o.jsx)(n.li,{children:"Protocol specific information about the endpoint"}),"\n",(0,o.jsx)(n.li,{children:"User friendly name of the endpoint"}),"\n",(0,o.jsx)(n.li,{children:"etc .."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"But most importantly it contains an unique identifier which we can use to fetch the values from the given endpoint etc."}),"\n",(0,o.jsxs)(n.p,{children:["The metadata from the data stream is described as DTDL (see above). The id is described in the ",(0,o.jsx)(n.code,{children:"$dtId"})," section of DTDL instance."]}),"\n",(0,o.jsxs)(n.p,{children:["We provide ",(0,o.jsx)(n.code,{children:"HTTP-GET"})," and ",(0,o.jsx)(n.code,{children:"HTTP-POST"})," endpoints for every datatype we support . The byte array endpoint can be used to import or export any kind of base 64 encoded data directly."]}),"\n",(0,o.jsx)(n.p,{children:"If you are fetching the values you are able to query those with following parameters:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"From"})," includes Values with a Timestamp equal or after the given filter, if no value is provided all values from beginning will be included"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"To"})," includes Values with a Timestamp before given filter, if no value is provided all values till the latest will be included"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"OrderBy"})," sort order of the values (asc, desc)"]}),"\n",(0,o.jsx)(n.li,{children:"'PageNumber' paginated result and their respective page number"}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"PageSize"})," value count included into one result (page)"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Here is an example query against our double endpoint with the given example model:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Tributech Node - Value Double Get",src:t(49261).A+"",width:"1297",height:"1293"})}),"\n",(0,o.jsx)(n.h2,{id:"proof-verification",children:"Proof Verification"}),"\n",(0,o.jsx)(n.p,{children:"All data collected by our Tributech Agents will be secured by a Proof which is also generated on the Agent. On the Tributech Node we can check if the given Proof and their associated values are not tempered or changed in anyway.  The first validation will be done when the Proof was received by the Node, every other validation needs to be triggered via our REST API."}),"\n",(0,o.jsxs)(n.p,{children:["For this example we will also use the example DTDL (see above) and their respective ",(0,o.jsx)(n.code,{children:"Stream Identifier"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"First we want to fetch all Proofs from a given time span, we can query those proofs with following parameters:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"From"})," includes Values with a Timestamp equal or after the given filter, ",(0,o.jsx)(n.strong,{children:"must to be provided"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"To"})," includes Values with a Timestamp before given filter, ",(0,o.jsx)(n.strong,{children:"must to be provided"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"OrderBy"})," sort order of the values (asc, desc)"]}),"\n",(0,o.jsx)(n.li,{children:"'PageNumber' paginated result and their respective page number"}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"PageSize"})," value count included into one result (page)"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Tributech Node - Proof  Get",src:t(72943).A+"",width:"1280",height:"1284"})}),"\n",(0,o.jsxs)(n.p,{children:["In the result we can see the latest ValidationResult. If we want to trigger a new Validation we simply use the ",(0,o.jsx)(n.code,{children:"lasttimestamp"})," value of the result and the given ",(0,o.jsx)(n.code,{children:"streamId"}),"  to use it for the  trigger of a validation via the rest endpoint:"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Tributech Node - Proof  Validate",src:t(86505).A+"",width:"1264",height:"1062"})}),"\n",(0,o.jsx)(n.p,{children:"You will see the result of the validation within the response body. If we want to look into the history of a given proof and their respective validation results we can use the exact same parameters onto the history rest endpoint:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Tributech Node - Proof  Validation History",src:t(43924).A+"",width:"1274",height:"1009"})}),"\n",(0,o.jsx)(n.p,{children:"We will see two Validation Results because we currently triggered one."}),"\n",(0,o.jsx)(n.h2,{id:"agent-configuration",children:"Agent Configuration"}),"\n",(0,o.jsx)(n.p,{children:"Our Tributech Agents can be configured either via SPA or DTDL. We recommend using the DTDL configuration option only for advanced users that are familiar with this technology. An invalid DTDL Model or Instance may result in an non-responsive Agent. The DTDL Model is required to be fully complete and partial updates are not supported. The node provides the following endpoints for the interacting with the DTDL model:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"agent/{deviceId}/get-config"})," to retrieve the current agent configuration which is provided by the agent itself"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"agent/{deviceId}/set-config"})," to submit the new configuration which will be presented to the agent"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The Request will trigger an command which will be send to the Agent via our MQTT Broker and will be validated by the Agent itself. If some error occurs the existing Configuration will be used and an error will be shown as response for the request."}),"\n",(0,o.jsx)(n.h2,{id:"remote-commands",children:"Remote Commands"}),"\n",(0,o.jsxs)(n.p,{children:["The Tributech Node has the capability to send a command to a given Agent Source. This enables various use cases where an custom Tributech Agent Source can execute some kind of command or write a variable on the given Server which it is connected to. It may also read a specific metadata from the Server and returns it via the ",(0,o.jsx)(n.code,{children:"CommandResponse"})," which will be send at the end of the command execution. Lastly the remote commands provide a way to notify the progress of the command execution via ",(0,o.jsx)(n.code,{children:"CommandStateUpdates"}),". Those capabilities are mainly implementation specific may or may not be send from the Tributech Agent Source."]}),"\n",(0,o.jsx)(n.p,{children:"The command it self will be triggered with following parameters:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"AgentId"})," unique identifier of the agent which is connected to the wanted source"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SourceId"})," unique identifier of the wanted source which executes the command"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CommandName"})," string identifier of the command name known to the source to identify the wanted operation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CommandBody"})," Base64 Encoded UTF 8 byte array of a json object which will be fetched by the source command to get additional parameters for the execution of the commands"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Timeout"})," time span when the command will be aborted by the node and information for the source when to stop the command"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The commands it self various by the capability of the targeted Tributech Agent Source. If the source is developed by a third party it may also execute a given command. It only needs to follow the specification described in the Tributech Agent Page and will receive the trigger from the node."}),"\n",(0,o.jsx)(n.h3,{id:"endpoints",children:"Endpoints"}),"\n",(0,o.jsx)(n.p,{children:"There are two main endpoints for the execution of remote commands :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"/agent/{agentId}/command/{sourceId}"})," will send an request and block the response till the command is executed and a response is received. It will abort if the command execution takes longer than the provided timeout"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"/agent/{agentId}/commandtrigger/{sourceId}"})," will send the request and return a transaction id. This Transaction Id can be used to match the given state updates and command response via webhook events, those events will contain the returned transaction id so you are able to trigger a command in a non-blocking manner."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"For the command trigger following webhook events are required to receive the response and state updates from the command :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SourceCommandResponseEvent"})," contains the final result of the execution"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SourceCommandStateUpdateEvent"})," contains the updates of the execution"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Create a Webhook subscription with the given events to receive the necessary information."}),"\n",(0,o.jsx)(n.h3,{id:"example-code",children:"Example Code"}),"\n",(0,o.jsx)(n.p,{children:"Example Code to create the Request Body for the Command Trigger :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'using System;\nusing System.Text;\nusing System.Text.Json;\n\npublic class Program\n{\n  public static void Main()\n  {\n    var commandPayload = new { NewBooleanValue = true};\n    \n    var requestCommandBody = Convert.ToBase64String(JsonSerializer.SerializeToUtf8Bytes(commandPayload));\n    \n    var requestBody = new { CommandName = "ExampleBoolCommand", CommandBody = requestCommandBody, Timeout = TimeSpan.FromSeconds(30)};\n    Console.WriteLine(JsonSerializer.Serialize(requestBody));\n  }\n}\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>s});var i=t(96540);const o={},a=i.createContext(o);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},43924:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/ProofValidationHistory-3f94174cf743f0c7b0c81cad63f07298.png"},49261:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/DoubleGETRequest-73ff59fcdf8b3d3e4a85d9ae51168db9.png"},72943:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/ProofGet-9ebef6ae2053e4ef463d5ef62b66d543.png"},77716:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/DemeterArchitectureOverviewAPIUsage-d17be1ee31db6d78010c69a7cba0e990.png"},86505:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/ProofValidate-0b0aac8b9d02e767990eab648759ca39.png"}}]);